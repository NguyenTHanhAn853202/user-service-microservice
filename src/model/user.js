const mongoose = require("mongoose")
const Schema = mongoose.Schema;
const mongooseDelete = require('mongoose-delete'); 
const bcrypt = require('bcrypt');
const SALT = process.env.SALT || 10

const defaulAvatar = `data:image/jpeg;base64,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`

const UserSchema = new Schema({
    username:{type: String, required: true,unique: true},
    password:{type: String, required: true},
    email:{type: String},
    phoneNumber:{type: String},
    address:{type: String},
    avatar:{type: String,default:defaulAvatar},
    role:{type: String, default:"user", enum:["admin","user"]},
    genders:{type: Boolean},
    token:{type: Array,default: []},
    verify:{type: Boolean, default:false}
},
{
    timestamps: true,
})



UserSchema.statics.comparePassword = async(password,userPassword)=>{
    return await bcrypt.compare(password,userPassword)
    
}

UserSchema.pre("save", async function(next){
    const user = this
    if(!user.isModified("password")) return next()
    const hash = await bcrypt.hash(user.password,SALT)
    user.password = hash
    next()
})

UserSchema.plugin(mongooseDelete, { overrideMethods: 'all' });

const User = mongoose.model("User", UserSchema)

module.exports = User

